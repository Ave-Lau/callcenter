import{t as e,z as l,v as a,aX as s,aY as t,_ as r,d as i,b as o,r as d,c as n,L as u,J as m,I as p,g as c,f,e as b,l as _,k as v,i as g,w as y,D as w,E as k,n as j,q as h,S as V,o as x,m as P,aZ as z,C,a_ as E,$ as U,F as I,av as q,h as F,aI as S}from"./index.9JKaP-sD.js";import{E as A}from"./el-dialog.CV9uHZVe.js";import"./el-overlay.Db2KRNtY.js";import{a as Z,E as $}from"./el-form-item.DdL6idCj.js";import{_ as M}from"./index.vue_vue_type_script_setup_true_lang.BZ54fJjU.js";import{E as R}from"./el-input.Chz6srB3.js";import{E as N,a as B}from"./el-tab-pane.DTO0zLnQ.js";import{E as O,a as T}from"./el-col.uB2vXthd.js";import{E as D}from"./el-card.Dwm3Wogt.js";import{E as J,a as G}from"./el-descriptions-item.D5S_1A6l.js";import{E as H}from"./el-button.B4H6IVGP.js";import{F as L}from"./index.BzMBcn4M.js";import{_ as Q}from"./_plugin-vue_export-helper.BCo6x5W8.js";import"./index.DnF326PC.js";import"./refs.DPAaRWip.js";import"./index.DuG78XL4.js";import"./el-popper.C3Pu_ij_.js";import"./index.lyQhgUr6.js";import"./error.CQ4af0Sv.js";import"./use-form-common-props.B0GfQdWg.js";import"./scroll.YSoXCINH.js";import"./castArray.BWQtUVzp.js";import"./_Uint8Array.DcERNRZL.js";import"./el-checkbox.Bur5g5lu.js";import"./isEqual.DuIQUmCM.js";import"./el-radio.CWnJc6dj.js";/* empty css               */import"./el-select.CCXhVsFx.js";import"./el-scrollbar.C274zESD.js";import"./index.BQYkukDI.js";import"./token.DWNpOE8r.js";import"./strings.CMCOzoru.js";import"./index.DhkCuil8.js";import"./debounce.CFz_ETfP.js";import"./_baseIteratee.B-FL-iVy.js";import"./index.DcZ-ksjR.js";import"./index.DoclTp79.js";import"./index.CZfMW75n.js";const W=e({size:{type:[Number,String],values:t,default:"",validator:e=>s(e)},shape:{type:String,values:["circle","square"],default:"circle"},icon:{type:a},src:{type:String,default:""},alt:String,srcSet:String,fit:{type:l(String),default:"cover"}}),X={error:e=>e instanceof Event},Y=i({name:"ElAvatar"});const K=h(r(i({...Y,props:W,emits:X,setup(e,{emit:l}){const a=e,t=o("avatar"),r=d(!1),i=n((()=>{const{size:e,icon:l,shape:s}=a,r=[t.b()];return u(e)&&r.push(t.m(e)),l&&r.push(t.m("icon")),s&&r.push(t.m(s)),r})),h=n((()=>{const{size:e}=a;return s(e)?t.cssVarBlock({size:m(e)||""}):void 0})),V=n((()=>({objectFit:a.fit})));function x(e){r.value=!0,l("error",e)}return p((()=>a.src),(()=>r.value=!1)),(e,l)=>(f(),c("span",{class:j(g(i)),style:v(g(h))},[!e.src&&!e.srcSet||r.value?e.icon?(f(),b(g(k),{key:1},{default:y((()=>[(f(),b(w(e.icon)))])),_:1})):_(e.$slots,"default",{key:2}):(f(),c("img",{key:0,src:e.src,alt:e.alt,srcset:e.srcSet,style:v(g(V)),onError:x},null,44,["src","alt","srcset"]))],6))}}),[["__file","avatar.vue"]])),ee={class:"app-container"},le={class:"w-full"},ae={class:"relative w-100px h-100px flex-center"},se={class:"mt-5"},te={class:"text-14px mt-2"},re={class:"mt-5"},ie={class:"text-14px mt-2"},oe={key:0},de={key:1},ne={class:"mt-5"},ue={class:"text-14px mt-2"},me={key:0},pe={key:1},ce={class:"dialog-footer"},fe=Q(i({__name:"index",setup(e){const l=d({}),a=V({visible:!1,title:"",type:""}),s=V({}),t=V({}),r=V({}),i=V({}),o=d(0),n=d(),u=d(0),m=d(),p={oldPassword:[{required:!0,message:"请输入原密码",trigger:"blur"}],newPassword:[{required:!0,message:"请输入新密码",trigger:"blur"}],confirmPassword:[{required:!0,message:"请再次输入新密码",trigger:"blur"}]},_={mobile:[{required:!0,message:"请输入手机号",trigger:"blur"},{pattern:/^1[3|4|5|6|7|8|9][0-9]\d{8}$/,message:"请输入正确的手机号码",trigger:"blur"}],code:[{required:!0,message:"请输入验证码",trigger:"blur"}]},v={email:[{required:!0,message:"请输入邮箱",trigger:"blur"},{pattern:/\w[-\w.+]*@([A-Za-z0-9][-A-Za-z0-9]+\.)+[A-Za-z]{2,14}/,message:"请输入正确的邮箱地址",trigger:"blur"}],code:[{required:!0,message:"请输入验证码",trigger:"blur"}]},w=e=>{switch(a.type=e,a.visible=!0,e){case"account":a.title="账号资料",s.id=l.value.id,s.nickname=l.value.nickname,s.gender=l.value.gender;break;case"password":a.title="修改密码";break;case"mobile":a.title="绑定手机";break;case"email":a.title="绑定邮箱"}};function j(){if(!r.mobile)return void S.error("请输入手机号");/^1[3-9]\d{9}$/.test(r.mobile)?z.sendMobileCode(r.mobile).then((()=>{S.success("验证码发送成功"),o.value=60,n.value=setInterval((()=>{o.value>0?o.value-=1:clearInterval(n.value)}),1e3)})):S.error("手机号格式不正确")}function h(){if(!i.email)return void S.error("请输入邮箱");/\w[-\w.+]*@([A-Za-z0-9][-A-Za-z0-9]+\.)+[A-Za-z]{2,14}/.test(i.email)?z.sendEmailCode(i.email).then((()=>{S.success("验证码发送成功"),u.value=60,m.value=setInterval((()=>{u.value>0?u.value-=1:clearInterval(m.value)}),1e3)})):S.error("邮箱格式不正确")}const Q=async()=>{if("account"===a.type)z.updateProfile(s).then((()=>{S.success("账号资料修改成功"),a.visible=!1,fe()}));else if("password"===a.type){if(t.newPassword!==t.confirmPassword)return void S.error("两次输入的密码不一致");z.changePassword(t).then((()=>{S.success("密码修改成功"),a.visible=!1}))}else"mobile"===a.type?z.bindOrChangeMobile(r).then((()=>{S.success("手机号绑定成功"),a.visible=!1,fe()})):"email"===a.type&&z.bindOrChangeEmail(i).then((()=>{S.success("邮箱绑定成功"),a.visible=!1,fe()}))},W=d(null),X=()=>{var e;null==(e=W.value)||e.click()},Y=async e=>{const a=e.target,s=a.files?a.files[0]:null;if(s)try{const e=await L.uploadFile(s);l.value.avatar=e.url,await z.updateProfile({avatar:e.url})}catch(t){S.error("头像上传失败")}},fe=async()=>{const e=await z.getProfile();l.value=e};return x((async()=>{n.value&&clearInterval(n.value),m.value&&clearInterval(m.value),await fe()})),(e,d)=>{const n=K,m=H,V=q("Edit"),x=k,z=q("User"),S=q("Male"),L=q("Female"),fe=G,be=q("Phone"),_e=q("Message"),ve=q("Timer"),ge=J,ye=D,we=B,ke=T,je=O,he=N,Ve=R,xe=Z,Pe=M,ze=$,Ce=A;return f(),c("div",ee,[P(he,{"tab-position":"left"},{default:y((()=>[P(we,{label:"账号信息"},{default:y((()=>[C("div",le,[P(ye,null,{default:y((()=>[C("div",ae,[P(n,{src:g(l).avatar,size:100},null,8,["src"]),P(m,{type:"info",class:"absolute bottom-0 right-0 cursor-pointer",circle:"",icon:g(E),size:"small",onClick:X},null,8,["icon"]),C("input",{ref_key:"fileInput",ref:W,type:"file",style:{display:"none"},onChange:Y},null,544)]),C("div",se,[U(I(g(l).nickname)+" ",1),P(x,{class:"align-middle cursor-pointer",onClick:d[0]||(d[0]=e=>w("account"))},{default:y((()=>[P(V)])),_:1})]),P(ge,{column:1,class:"mt-10"},{default:y((()=>[P(fe,null,{label:y((()=>[P(x,{class:"align-middle"},{default:y((()=>[P(z)])),_:1}),d[17]||(d[17]=U(" 用户名 "))])),default:y((()=>[U(" "+I(g(l).username)+" ",1),1===g(l).gender?(f(),b(x,{key:0,class:"align-middle color-blue"},{default:y((()=>[P(S)])),_:1})):(f(),b(x,{key:1,class:"align-middle color-pink"},{default:y((()=>[P(L)])),_:1}))])),_:1}),P(fe,null,{label:y((()=>[P(x,{class:"align-middle"},{default:y((()=>[P(be)])),_:1}),d[18]||(d[18]=U(" 手机号码 "))])),default:y((()=>[U(" "+I(g(l).mobile),1)])),_:1}),P(fe,null,{label:y((()=>[P(x,{class:"align-middle"},{default:y((()=>[P(_e)])),_:1}),d[19]||(d[19]=U(" 邮箱 "))])),default:y((()=>[U(" "+I(g(l).email),1)])),_:1}),P(fe,null,{label:y((()=>d[20]||(d[20]=[C("div",{class:"i-svg:tree"},null,-1),U(" 部门 ")]))),default:y((()=>[U(" "+I(g(l).deptName),1)])),_:1}),P(fe,null,{label:y((()=>d[21]||(d[21]=[C("div",{class:"i-svg:role"},null,-1),U(" 角色 ")]))),default:y((()=>[U(" "+I(g(l).roleNames),1)])),_:1}),P(fe,null,{label:y((()=>[P(x,{class:"align-middle"},{default:y((()=>[P(ve)])),_:1}),d[22]||(d[22]=U(" 创建日期 "))])),default:y((()=>[U(" "+I(g(l).createTime),1)])),_:1})])),_:1})])),_:1})])])),_:1}),P(we,{label:"安全设置"},{default:y((()=>[P(ye,null,{default:y((()=>[P(je,null,{default:y((()=>[P(ke,{span:16},{default:y((()=>[d[25]||(d[25]=C("div",{class:"font-bold"},"账户密码",-1)),C("div",te,[d[24]||(d[24]=U(" 定期修改密码有助于保护账户安全 ")),P(m,{type:"primary",plain:"",size:"small",class:"ml-5",onClick:d[1]||(d[1]=()=>w("password"))},{default:y((()=>d[23]||(d[23]=[U(" 修改 ")]))),_:1,__:[23]})])])),_:1,__:[25]})])),_:1}),C("div",re,[d[28]||(d[28]=C("div",{class:"font-bold"},"绑定手机",-1)),C("div",ie,[g(l).mobile?(f(),c("span",oe,"已绑定手机号："+I(g(l).mobile),1)):(f(),c("span",de,"未绑定手机")),g(l).mobile?(f(),b(m,{key:2,type:"primary",plain:"",size:"small",class:"ml-5",onClick:d[2]||(d[2]=()=>w("mobile"))},{default:y((()=>d[26]||(d[26]=[U(" 更换 ")]))),_:1,__:[26]})):(f(),b(m,{key:3,type:"primary",plain:"",size:"small",class:"ml-5",onClick:d[3]||(d[3]=()=>w("mobile"))},{default:y((()=>d[27]||(d[27]=[U(" 绑定 ")]))),_:1,__:[27]}))])]),C("div",ne,[d[31]||(d[31]=C("div",{class:"font-bold"},"绑定邮箱",-1)),C("div",ue,[g(l).email?(f(),c("span",me,"已绑定邮箱："+I(g(l).email),1)):(f(),c("span",pe,"未绑定邮箱")),g(l).email?(f(),b(m,{key:2,type:"primary",plain:"",size:"small",class:"ml-5",onClick:d[4]||(d[4]=()=>w("email"))},{default:y((()=>d[29]||(d[29]=[U(" 更换 ")]))),_:1,__:[29]})):(f(),b(m,{key:3,type:"primary",plain:"",size:"small",class:"ml-5",onClick:d[5]||(d[5]=()=>w("email"))},{default:y((()=>d[30]||(d[30]=[U(" 绑定 ")]))),_:1,__:[30]}))])])])),_:1})])),_:1})])),_:1}),P(Ce,{modelValue:g(a).visible,"onUpdate:modelValue":d[16]||(d[16]=e=>g(a).visible=e),title:g(a).title,width:500},{footer:y((()=>[C("span",ce,[P(m,{onClick:d[15]||(d[15]=e=>g(a).visible=!1)},{default:y((()=>d[32]||(d[32]=[U("取消")]))),_:1,__:[32]}),P(m,{type:"primary",onClick:Q},{default:y((()=>d[33]||(d[33]=[U("确定")]))),_:1,__:[33]})])])),default:y((()=>["account"===g(a).type?(f(),b(ze,{key:0,ref:"userProfileFormRef",model:g(s),"label-width":100},{default:y((()=>[P(xe,{label:"昵称"},{default:y((()=>[P(Ve,{modelValue:g(s).nickname,"onUpdate:modelValue":d[6]||(d[6]=e=>g(s).nickname=e)},null,8,["modelValue"])])),_:1}),P(xe,{label:"性别"},{default:y((()=>[P(Pe,{modelValue:g(s).gender,"onUpdate:modelValue":d[7]||(d[7]=e=>g(s).gender=e),code:"gender"},null,8,["modelValue"])])),_:1})])),_:1},8,["model"])):F("",!0),"password"===g(a).type?(f(),b(ze,{key:1,ref:"passwordChangeFormRef",model:g(t),rules:p,"label-width":100},{default:y((()=>[P(xe,{label:"原密码",prop:"oldPassword"},{default:y((()=>[P(Ve,{modelValue:g(t).oldPassword,"onUpdate:modelValue":d[8]||(d[8]=e=>g(t).oldPassword=e),type:"password","show-password":""},null,8,["modelValue"])])),_:1}),P(xe,{label:"新密码",prop:"newPassword"},{default:y((()=>[P(Ve,{modelValue:g(t).newPassword,"onUpdate:modelValue":d[9]||(d[9]=e=>g(t).newPassword=e),type:"password","show-password":""},null,8,["modelValue"])])),_:1}),P(xe,{label:"确认密码",prop:"confirmPassword"},{default:y((()=>[P(Ve,{modelValue:g(t).confirmPassword,"onUpdate:modelValue":d[10]||(d[10]=e=>g(t).confirmPassword=e),type:"password","show-password":""},null,8,["modelValue"])])),_:1})])),_:1},8,["model"])):"mobile"===g(a).type?(f(),b(ze,{key:2,ref:"mobileBindingFormRef",model:g(r),rules:_,"label-width":100},{default:y((()=>[P(xe,{label:"手机号码",prop:"mobile"},{default:y((()=>[P(Ve,{modelValue:g(r).mobile,"onUpdate:modelValue":d[11]||(d[11]=e=>g(r).mobile=e),style:{width:"250px"}},null,8,["modelValue"])])),_:1}),P(xe,{label:"验证码",prop:"code"},{default:y((()=>[P(Ve,{modelValue:g(r).code,"onUpdate:modelValue":d[12]||(d[12]=e=>g(r).code=e),style:{width:"250px"}},{append:y((()=>[P(m,{class:"ml-5",disabled:g(o)>0,onClick:j},{default:y((()=>[U(I(g(o)>0?`${g(o)}s后重新发送`:"发送验证码"),1)])),_:1},8,["disabled"])])),_:1},8,["modelValue"])])),_:1})])),_:1},8,["model"])):"email"===g(a).type?(f(),b(ze,{key:3,ref:"emailBindingFormRef",model:g(i),rules:v,"label-width":100},{default:y((()=>[P(xe,{label:"邮箱",prop:"email"},{default:y((()=>[P(Ve,{modelValue:g(i).email,"onUpdate:modelValue":d[13]||(d[13]=e=>g(i).email=e),style:{width:"250px"}},null,8,["modelValue"])])),_:1}),P(xe,{label:"验证码",prop:"code"},{default:y((()=>[P(Ve,{modelValue:g(i).code,"onUpdate:modelValue":d[14]||(d[14]=e=>g(i).code=e),style:{width:"250px"}},{append:y((()=>[P(m,{class:"ml-5",disabled:g(u)>0,onClick:h},{default:y((()=>[U(I(g(u)>0?`${g(u)}s后重新发送`:"发送验证码"),1)])),_:1},8,["disabled"])])),_:1},8,["modelValue"])])),_:1})])),_:1},8,["model"])):F("",!0)])),_:1},8,["modelValue","title"])])}}}),[["__scopeId","data-v-28ab2a0c"]]);export{fe as default};
