import{d as e,r as l,S as t,o as a,g as i,f as o,C as s,m as r,w as u,Z as n,i as d,$ as p,V as m,e as c,h as _,F as f,b8 as b,as as y,P as v,Q as g,av as h,aZ as w,aI as j}from"./index.9JKaP-sD.js";import{v as k}from"./el-loading.at4BLbaz.js";import{E as V,a as x}from"./el-descriptions-item.D5S_1A6l.js";import{E as C}from"./el-dialog.CV9uHZVe.js";import"./el-overlay.Db2KRNtY.js";import{_ as U}from"./index.vue_vue_type_script_setup_true_lang.CPfpxIT6.js";import{a as S,E as T}from"./el-radio.CWnJc6dj.js";import{_ as E}from"./index.vue_vue_type_script_setup_true_lang.BZ54fJjU.js";import{E as N}from"./el-card.Dwm3Wogt.js";import{_ as z}from"./index.DG_UqU4t.js";import{a as F,E as I}from"./el-table-column.hNoDaJcq.js";import"./el-checkbox.Bur5g5lu.js";import"./el-tooltip.l0sNRNKZ.js";import"./el-popper.C3Pu_ij_.js";import"./el-scrollbar.C274zESD.js";/* empty css               */import{_ as q}from"./DictLabel.vue_vue_type_script_setup_true_lang.DhQyB9FZ.js";import{a as P,E as D}from"./el-form-item.DdL6idCj.js";import{E as L}from"./el-button.B4H6IVGP.js";import{E as O,a as R}from"./el-select.CCXhVsFx.js";import{E as A}from"./el-input.Chz6srB3.js";import{N as B}from"./notice.DiMJB5Q5.js";import{E as H}from"./el-message-box.BZvFx5Nz.js";import{E as M}from"./index.BQYkukDI.js";import"./use-form-common-props.B0GfQdWg.js";import"./index.DnF326PC.js";import"./refs.DPAaRWip.js";import"./index.DuG78XL4.js";import"./index.lyQhgUr6.js";import"./error.CQ4af0Sv.js";import"./scroll.YSoXCINH.js";import"./index.BzMBcn4M.js";import"./el-pagination.I7-4RGBb.js";import"./isEqual.DuIQUmCM.js";import"./_Uint8Array.DcERNRZL.js";import"./_plugin-vue_export-helper.BCo6x5W8.js";import"./_baseIteratee.B-FL-iVy.js";import"./debounce.CFz_ETfP.js";import"./index.DcZ-ksjR.js";import"./castArray.BWQtUVzp.js";import"./token.DWNpOE8r.js";import"./strings.CMCOzoru.js";import"./index.DhkCuil8.js";import"./index.DoclTp79.js";const Z={class:"app-container"},Q={class:"search-bar"},$={class:"flex-x-start"},G={key:0,class:"flex-x-start"},J={key:1,class:"flex-x-start"},K={class:"dialog-footer"},W={class:"flex-x-between"},Y={class:"dialog-toolbar"},X=["innerHTML"],ee=e({name:"Notice",inheritAttrs:!1,__name:"index",setup(e){const ee=l(),le=l(),te=l(!1),ae=l([]),ie=l(0),oe=t({pageNum:1,pageSize:10}),se=l([]),re=l([]),ue=t({title:"",visible:!1}),ne=t({level:"L",targetType:1}),de=t({title:[{required:!0,message:"请输入通知标题",trigger:"blur"}],content:[{required:!0,message:"请输入通知内容",trigger:"blur",validator:(e,l,t)=>{l.replace(/<[^>]+>/g,"").trim()?t():t(new Error("请输入通知内容"))}}],type:[{required:!0,message:"请选择通知类型",trigger:"change"}]}),pe=t({visible:!1}),me=l({});function ce(){te.value=!0,B.getPage(oe).then((e=>{re.value=e.list,ie.value=e.total})).finally((()=>{te.value=!1}))}function _e(){ee.value.resetFields(),oe.pageNum=1,ce()}function fe(e){ae.value=e.map((e=>e.id))}function be(e){w.getOptions().then((e=>{se.value=e})),ue.visible=!0,e?(ue.title="修改公告",B.getFormData(e).then((e=>{Object.assign(ne,e)}))):(Object.assign(ne,{level:0,targetType:0}),ue.title="新增公告")}function ye(){ue.visible=!1,le.value.resetFields(),le.value.clearValidate(),ne.id=void 0,ne.targetType=1}function ve(e){const l=[e||ae.value].join(",");l?H.confirm("确认删除已选中的数据项?","警告",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((()=>{te.value=!0,B.deleteByIds(l).then((()=>{j.success("删除成功"),_e()})).finally((()=>te.value=!1))}),(()=>{j.info("已取消删除")})):j.warning("请勾选删除项")}const ge=()=>{pe.visible=!1};return a((()=>{ce()})),(e,l)=>{const t=A,a=P,w=R,H=O,he=L,we=D,je=F,ke=q,Ve=M,xe=I,Ce=z,Ue=N,Se=E,Te=T,Ee=S,Ne=U,ze=C,Fe=h("Close"),Ie=x,qe=V,Pe=b("hasPerm"),De=k;return o(),i("div",Z,[s("div",Q,[r(we,{ref_key:"queryFormRef",ref:ee,model:d(oe),inline:!0,"label-suffix":":"},{default:u((()=>[r(a,{label:"标题",prop:"title"},{default:u((()=>[r(t,{modelValue:d(oe).title,"onUpdate:modelValue":l[0]||(l[0]=e=>d(oe).title=e),placeholder:"标题",clearable:"",onKeyup:l[1]||(l[1]=n((e=>ce()),["enter"]))},null,8,["modelValue"])])),_:1}),r(a,{label:"发布状态",prop:"publishStatus"},{default:u((()=>[r(H,{modelValue:d(oe).publishStatus,"onUpdate:modelValue":l[2]||(l[2]=e=>d(oe).publishStatus=e),class:"!w-[100px]",clearable:"",placeholder:"全部"},{default:u((()=>[r(w,{value:0,label:"未发布"}),r(w,{value:1,label:"已发布"}),r(w,{value:-1,label:"已撤回"})])),_:1},8,["modelValue"])])),_:1}),r(a,null,{default:u((()=>[r(he,{type:"primary",icon:"search",onClick:l[3]||(l[3]=e=>ce())},{default:u((()=>l[21]||(l[21]=[p("搜索")]))),_:1,__:[21]}),r(he,{icon:"refresh",onClick:l[4]||(l[4]=e=>_e())},{default:u((()=>l[22]||(l[22]=[p("重置")]))),_:1,__:[22]})])),_:1})])),_:1},8,["model"])]),r(Ue,{shadow:"never",class:"table-wrapper"},{header:u((()=>[m((o(),c(he,{type:"success",icon:"plus",onClick:l[5]||(l[5]=e=>be())},{default:u((()=>l[23]||(l[23]=[p(" 新增通知 ")]))),_:1,__:[23]})),[[Pe,["sys:notice:add"]]]),m((o(),c(he,{type:"danger",disabled:0===d(ae).length,icon:"delete",onClick:l[6]||(l[6]=e=>ve())},{default:u((()=>l[24]||(l[24]=[p(" 删除 ")]))),_:1,__:[24]},8,["disabled"])),[[Pe,["sys:notice:delete"]]])])),default:u((()=>[m((o(),c(xe,{ref:"dataTableRef",data:d(re),"highlight-current-row":"",onSelectionChange:fe},{default:u((()=>[r(je,{type:"selection",width:"55",align:"center"}),r(je,{type:"index",label:"序号",width:"60"}),r(je,{label:"通知标题",prop:"title","min-width":"200"}),r(je,{align:"center",label:"通知类型",width:"150"},{default:u((e=>[r(ke,{modelValue:e.row.type,"onUpdate:modelValue":l=>e.row.type=l,code:"notice_type"},null,8,["modelValue","onUpdate:modelValue"])])),_:1}),r(je,{align:"center",label:"发布人",prop:"publisherName",width:"150"}),r(je,{align:"center",label:"通知等级",width:"100"},{default:u((e=>[r(ke,{modelValue:e.row.level,"onUpdate:modelValue":l=>e.row.level=l,code:"notice_level"},null,8,["modelValue","onUpdate:modelValue"])])),_:1}),r(je,{align:"center",label:"通告目标类型",prop:"targetType","min-width":"100"},{default:u((e=>[1==e.row.targetType?(o(),c(Ve,{key:0,type:"warning"},{default:u((()=>l[25]||(l[25]=[p("全体")]))),_:1,__:[25]})):_("",!0),2==e.row.targetType?(o(),c(Ve,{key:1,type:"success"},{default:u((()=>l[26]||(l[26]=[p("指定")]))),_:1,__:[26]})):_("",!0)])),_:1}),r(je,{align:"center",label:"发布状态","min-width":"100"},{default:u((e=>[0==e.row.publishStatus?(o(),c(Ve,{key:0,type:"info"},{default:u((()=>l[27]||(l[27]=[p("未发布")]))),_:1,__:[27]})):_("",!0),1==e.row.publishStatus?(o(),c(Ve,{key:1,type:"success"},{default:u((()=>l[28]||(l[28]=[p("已发布")]))),_:1,__:[28]})):_("",!0),-1==e.row.publishStatus?(o(),c(Ve,{key:2,type:"warning"},{default:u((()=>l[29]||(l[29]=[p("已撤回")]))),_:1,__:[29]})):_("",!0)])),_:1}),r(je,{label:"操作时间",width:"250"},{default:u((e=>[s("div",$,[l[30]||(l[30]=s("span",null,"创建时间：",-1)),s("span",null,f(e.row.createTime||"-"),1)]),1===e.row.publishStatus?(o(),i("div",G,[l[31]||(l[31]=s("span",null,"发布时间：",-1)),s("span",null,f(e.row.publishTime||"-"),1)])):-1===e.row.publishStatus?(o(),i("div",J,[l[32]||(l[32]=s("span",null,"撤回时间：",-1)),s("span",null,f(e.row.revokeTime||"-"),1)])):_("",!0)])),_:1}),r(je,{align:"center",fixed:"right",label:"操作",width:"150"},{default:u((e=>[r(he,{type:"primary",size:"small",link:"",onClick:l=>(async e=>{const l=await B.getDetail(e);me.value=l,pe.visible=!0})(e.row.id)},{default:u((()=>l[33]||(l[33]=[p(" 查看 ")]))),_:2,__:[33]},1032,["onClick"]),1!=e.row.publishStatus?m((o(),c(he,{key:0,type:"primary",size:"small",link:"",onClick:l=>{return t=e.row.id,void B.publish(t).then((()=>{j.success("发布成功"),ce()}));var t}},{default:u((()=>l[34]||(l[34]=[p(" 发布 ")]))),_:2,__:[34]},1032,["onClick"])),[[Pe,["sys:notice:publish"]]]):_("",!0),1==e.row.publishStatus?m((o(),c(he,{key:1,type:"primary",size:"small",link:"",onClick:l=>{return t=e.row.id,void B.revoke(t).then((()=>{j.success("撤回成功"),ce()}));var t}},{default:u((()=>l[35]||(l[35]=[p(" 撤回 ")]))),_:2,__:[35]},1032,["onClick"])),[[Pe,["sys:notice:revoke"]]]):_("",!0),1!=e.row.publishStatus?m((o(),c(he,{key:2,type:"primary",size:"small",link:"",onClick:l=>be(e.row.id)},{default:u((()=>l[36]||(l[36]=[p(" 编辑 ")]))),_:2,__:[36]},1032,["onClick"])),[[Pe,["sys:notice:edit"]]]):_("",!0),1!=e.row.publishStatus?m((o(),c(he,{key:3,type:"danger",size:"small",link:"",onClick:l=>ve(e.row.id)},{default:u((()=>l[37]||(l[37]=[p(" 删除 ")]))),_:2,__:[37]},1032,["onClick"])),[[Pe,["sys:notice:delete"]]]):_("",!0)])),_:1})])),_:1},8,["data"])),[[De,d(te)]]),d(ie)>0?(o(),c(Ce,{key:0,total:d(ie),"onUpdate:total":l[7]||(l[7]=e=>y(ie)?ie.value=e:null),page:d(oe).pageNum,"onUpdate:page":l[8]||(l[8]=e=>d(oe).pageNum=e),limit:d(oe).pageSize,"onUpdate:limit":l[9]||(l[9]=e=>d(oe).pageSize=e),onPagination:l[10]||(l[10]=e=>ce())},null,8,["total","page","limit"])):_("",!0)])),_:1}),r(ze,{modelValue:d(ue).visible,"onUpdate:modelValue":l[19]||(l[19]=e=>d(ue).visible=e),title:d(ue).title,top:"3vh",width:"80%",onClose:ye},{footer:u((()=>[s("div",K,[r(he,{type:"primary",onClick:l[17]||(l[17]=e=>{le.value.validate((e=>{if(e){te.value=!0;const e=ne.id;e?B.update(e,ne).then((()=>{j.success("修改成功"),ye(),_e()})).finally((()=>te.value=!1)):B.add(ne).then((()=>{j.success("新增成功"),ye(),_e()})).finally((()=>te.value=!1))}}))})},{default:u((()=>l[40]||(l[40]=[p("确定")]))),_:1,__:[40]}),r(he,{onClick:l[18]||(l[18]=e=>ye())},{default:u((()=>l[41]||(l[41]=[p("取消")]))),_:1,__:[41]})])])),default:u((()=>[r(we,{ref_key:"dataFormRef",ref:le,model:d(ne),rules:d(de),"label-width":"100px"},{default:u((()=>[r(a,{label:"通知标题",prop:"title"},{default:u((()=>[r(t,{modelValue:d(ne).title,"onUpdate:modelValue":l[11]||(l[11]=e=>d(ne).title=e),placeholder:"通知标题",clearable:""},null,8,["modelValue"])])),_:1}),r(a,{label:"通知类型",prop:"type"},{default:u((()=>[r(Se,{modelValue:d(ne).type,"onUpdate:modelValue":l[12]||(l[12]=e=>d(ne).type=e),code:"notice_type"},null,8,["modelValue"])])),_:1}),r(a,{label:"通知等级",prop:"level"},{default:u((()=>[r(Se,{modelValue:d(ne).level,"onUpdate:modelValue":l[13]||(l[13]=e=>d(ne).level=e),code:"notice_level"},null,8,["modelValue"])])),_:1}),r(a,{label:"目标类型",prop:"targetType"},{default:u((()=>[r(Ee,{modelValue:d(ne).targetType,"onUpdate:modelValue":l[14]||(l[14]=e=>d(ne).targetType=e)},{default:u((()=>[r(Te,{value:1},{default:u((()=>l[38]||(l[38]=[p("全体")]))),_:1,__:[38]}),r(Te,{value:2},{default:u((()=>l[39]||(l[39]=[p("指定")]))),_:1,__:[39]})])),_:1},8,["modelValue"])])),_:1}),2==d(ne).targetType?(o(),c(a,{key:0,label:"指定用户",prop:"targetUserIds"},{default:u((()=>[r(H,{modelValue:d(ne).targetUserIds,"onUpdate:modelValue":l[15]||(l[15]=e=>d(ne).targetUserIds=e),multiple:"",search:"",placeholder:"请选择指定用户"},{default:u((()=>[(o(!0),i(v,null,g(d(se),(e=>(o(),c(w,{key:e.value,label:e.label,value:e.value},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1})):_("",!0),r(a,{label:"通知内容",prop:"content"},{default:u((()=>[r(Ne,{modelValue:d(ne).content,"onUpdate:modelValue":l[16]||(l[16]=e=>d(ne).content=e)},null,8,["modelValue"])])),_:1})])),_:1},8,["model","rules"])])),_:1},8,["modelValue","title"]),r(ze,{modelValue:d(pe).visible,"onUpdate:modelValue":l[20]||(l[20]=e=>d(pe).visible=e),"show-close":!1,width:"50%","append-to-body":"",onClose:ge},{header:u((()=>[s("div",W,[l[42]||(l[42]=s("span",null,"通知公告详情",-1)),s("div",Y,[r(he,{circle:"",onClick:ge},{icon:u((()=>[r(Fe)])),_:1})])])])),default:u((()=>[r(qe,{column:1},{default:u((()=>[r(Ie,{label:"标题："},{default:u((()=>[p(f(d(me).title),1)])),_:1}),r(Ie,{label:"发布状态："},{default:u((()=>[0==d(me).publishStatus?(o(),c(Ve,{key:0,type:"info"},{default:u((()=>l[43]||(l[43]=[p("未发布")]))),_:1,__:[43]})):1==d(me).publishStatus?(o(),c(Ve,{key:1,type:"success"},{default:u((()=>l[44]||(l[44]=[p("已发布")]))),_:1,__:[44]})):-1==d(me).publishStatus?(o(),c(Ve,{key:2,type:"warning"},{default:u((()=>l[45]||(l[45]=[p("已撤回")]))),_:1,__:[45]})):_("",!0)])),_:1}),r(Ie,{label:"发布人："},{default:u((()=>[p(f(d(me).publisherName),1)])),_:1}),r(Ie,{label:"发布时间："},{default:u((()=>[p(f(d(me).publishTime),1)])),_:1}),r(Ie,{label:"公告内容："},{default:u((()=>[s("div",{class:"notice-content",innerHTML:d(me).content},null,8,X)])),_:1})])),_:1})])),_:1},8,["modelValue"])])}}});export{ee as default};
