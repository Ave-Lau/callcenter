import{d as e,bd as l,an as t,r as a,I as s,g as i,f as u,m as n,k as r,i as o,as as p,w as d,$ as m,F as c,C as f,E as y,av as v,j as g,aI as _,e as h,h as b,be as j,o as x,P as w}from"./index.9JKaP-sD.js";import{a as V,E as F}from"./el-form-item.DdL6idCj.js";import{E as k,a as C}from"./el-progress.DHfGD-Rk.js";import{E as S}from"./el-button.B4H6IVGP.js";import{F as z}from"./index.BzMBcn4M.js";import{_ as M}from"./_plugin-vue_export-helper.BCo6x5W8.js";import{E as I,a as O}from"./el-image-viewer.CUEYeq4E.js";import{E as U}from"./el-link.CV3V6DlU.js";import"./use-form-common-props.B0GfQdWg.js";import"./castArray.BWQtUVzp.js";import"./error.CQ4af0Sv.js";import"./_Uint8Array.DcERNRZL.js";import"./isEqual.DuIQUmCM.js";import"./index.DuG78XL4.js";import"./index.DnF326PC.js";import"./debounce.CFz_ETfP.js";import"./position.DH-Clxj7.js";import"./index.DoclTp79.js";import"./scroll.YSoXCINH.js";const E={class:"el-upload-list__item-info"},L=["onClick"],N={class:"el-upload-list__item-file-name"},W=["onClick"],q=M(e({__name:"FileUpload",props:l({data:{type:Object,default:()=>({})},name:{type:String,default:"file"},limit:{type:Number,default:10},maxFileSize:{type:Number,default:10},accept:{type:String,default:"*"},uploadBtnText:{type:String,default:"上传文件"},style:{type:Object,default:()=>({width:"300px"})}},{modelValue:{type:[Array],required:!0,default:()=>[]},modelModifiers:{}}),emits:["update:modelValue"],setup(e){const l=e,h=t(e,"modelValue"),b=a([]),j=a(!1),x=a(0);function w(e){return!(e.size>1024*l.maxFileSize*1024)||(_.warning("上传文件不能大于"+l.maxFileSize+"M"),!1)}function V(e){return new Promise(((t,a)=>{const s=e.file,i=new FormData;i.append(l.name,s),Object.keys(l.data).forEach((e=>{i.append(e,l.data[e])})),z.upload(i).then((e=>{t(e)})).catch((e=>{a(e)}))}))}s(h,(e=>{b.value=e.map((e=>{var l;return{name:e.name?e.name:null==(l=e.url)?void 0:l.substring(e.url.lastIndexOf("/")+1),url:e.url,status:"success",uid:Date.now()<<13|Math.floor(8192*Math.random())}}))}),{immediate:!0});const F=e=>{x.value=e.percent},M=(e,l,t)=>{if(_.success("上传成功"),t.every((e=>"success"===e.status||"fail"===e.status))){let e=[];t.map((l=>{if("success"===l.status){let t=l.response;t&&e.push({name:t.name,url:t.url})}else b.value.splice(b.value.findIndex((e=>e.uid===l.uid)),1)})),e.length>0&&(h.value=[...h.value,...e])}},I=e=>{_.error("上传失败")};return(e,t)=>{const a=S,s=v("Document"),_=y,O=v("Close"),U=k,q=C;return u(),i("div",null,[n(U,{"file-list":o(b),"onUpdate:fileList":t[0]||(t[0]=e=>p(b)?b.value=e:null),style:r(l.style),"before-upload":w,"http-request":V,"on-progress":F,"on-success":M,"on-error":I,accept:l.accept,limit:l.limit,multiple:""},{file:d((({file:e})=>[f("div",E,[f("a",{class:"el-upload-list__item-name",onClick:l=>function(e){const{url:l,name:t}=e;l&&z.download(l,t)}(e)},[n(_,null,{default:d((()=>[n(s)])),_:1}),f("span",N,c(e.name),1),f("span",{class:"el-icon--close",onClick:g((l=>{return t=e.url,void z.delete(t).then((()=>{h.value=h.value.filter((e=>e.url!==t))}));var t}),["stop"])},[n(_,null,{default:d((()=>[n(O)])),_:1})],8,W)],8,L)])])),default:d((()=>[n(a,{type:"primary",disabled:o(b).length>=l.limit},{default:d((()=>[m(c(l.uploadBtnText),1)])),_:1},8,["disabled"])])),_:1},8,["file-list","style","accept","limit"]),n(q,{style:r({display:o(j)?"inline-flex":"none",width:"100%"}),percentage:o(x)},null,8,["style","percentage"])])}}}),[["__scopeId","data-v-409769f1"]]),D=M(e({__name:"SingleImageUpload",props:l({data:{type:Object,default:()=>({})},name:{type:String,default:"file"},maxFileSize:{type:Number,default:10},accept:{type:String,default:"image/*"},style:{type:Object,default:()=>({width:"150px",height:"150px"})}},{modelValue:{type:String,default:()=>""},modelModifiers:{}}),emits:["update:modelValue"],setup(e){j((e=>({f0a7078e:l.style.width,54141114:l.style.height})));const l=e,a=t(e,"modelValue");function s(e){return l.accept.split(",").map((e=>e.trim())).some((l=>"image/*"===l?e.type.startsWith("image/"):l.startsWith(".")?e.name.toLowerCase().endsWith(l):e.type===l))?!(e.size>1024*l.maxFileSize*1024)||(_.warning("上传图片不能大于"+l.maxFileSize+"M"),!1):(_.warning(`上传文件的格式不正确，仅支持：${l.accept}`),!1)}function i(e){return new Promise(((t,a)=>{const s=e.file,i=new FormData;i.append(l.name,s),Object.keys(l.data).forEach((e=>{i.append(e,l.data[e])})),z.upload(i).then((e=>{t(e)})).catch((e=>{a(e)}))}))}function r(){a.value=""}const o=e=>{_.success("上传成功"),a.value=e.url},p=e=>{_.error("上传失败: "+e.message)};return(e,t)=>{const m=I,c=v("CircleCloseFilled"),f=y,_=v("Plus"),j=k;return u(),h(j,{modelValue:a.value,"onUpdate:modelValue":t[0]||(t[0]=e=>a.value=e),class:"single-upload","list-type":"picture-card","show-file-list":!1,accept:l.accept,"before-upload":s,"http-request":i,"on-success":o,"on-error":p},{default:d((()=>[a.value?(u(),h(m,{key:0,src:a.value},null,8,["src"])):b("",!0),a.value?(u(),h(f,{key:1,class:"single-upload__delete-btn",onClick:g(r,["stop"])},{default:d((()=>[n(c)])),_:1})):(u(),h(f,{key:2,class:"single-upload__add-btn"},{default:d((()=>[n(_)])),_:1}))])),_:1},8,["modelValue","accept"])}}}),[["__scopeId","data-v-ec966876"]]),P={style:{width:"100%"}},A=["src"],H={class:"el-upload-list__item-actions"},Q=["onClick"],K=["onClick"],Z=e({__name:"MultiImageUpload",props:l({data:{type:Object,default:()=>({})},name:{type:String,default:"file"},limit:{type:Number,default:10},maxFileSize:{type:Number,default:10},accept:{type:String,default:"image/*"}},{modelValue:{type:[Array],default:()=>[]},modelModifiers:{}}),emits:["update:modelValue"],setup(e){const l=e,s=a(!1),r=a(0),m=t(e,"modelValue"),c=a([]);function g(e){return l.accept.split(",").map((e=>e.trim())).some((l=>"image/*"===l?e.type.startsWith("image/"):l.startsWith(".")?e.name.toLowerCase().endsWith(l):e.type===l))?!(e.size>1024*l.maxFileSize*1024)||(_.warning("上传图片不能大于"+l.maxFileSize+"M"),!1):(_.warning(`上传文件的格式不正确，仅支持：${l.accept}`),!1)}function j(e){return new Promise(((t,a)=>{const s=e.file,i=new FormData;i.append(l.name,s),Object.keys(l.data).forEach((e=>{i.append(e,l.data[e])})),z.upload(i).then((e=>{t(e)})).catch((e=>{a(e)}))}))}function V(){_.warning("最多只能上传"+l.limit+"张图片")}const F=(e,l)=>{_.success("上传成功");const t=c.value.findIndex((e=>e.uid===l.uid));-1!==t&&(c.value[t].url=e.url,c.value[t].status="success",m.value[t]=e.url)},C=e=>{_.error("上传失败: "+e.message)},S=()=>{s.value=!1};return x((()=>{c.value=m.value.map((e=>({url:e})))})),(e,t)=>{const a=v("Plus"),_=y,x=v("zoom-in"),M=v("Delete"),I=k,U=O;return u(),i(w,null,[n(I,{"file-list":o(c),"onUpdate:fileList":t[0]||(t[0]=e=>p(c)?c.value=e:null),"list-type":"picture-card","before-upload":g,"http-request":j,"on-success":F,"on-error":C,"on-exceed":V,accept:l.accept,limit:l.limit,multiple:""},{file:d((({file:e})=>[f("div",P,[f("img",{class:"el-upload-list__item-thumbnail",src:e.url},null,8,A),f("span",H,[f("span",{onClick:l=>{return t=e.url,r.value=m.value.findIndex((e=>e===t)),void(s.value=!0);var t}},[n(_,null,{default:d((()=>[n(x)])),_:1})],8,Q),f("span",{onClick:l=>{return t=e.url,void z.delete(t).then((()=>{const e=m.value.indexOf(t);-1!==e&&(m.value.splice(e,1),c.value.splice(e,1))}));var t}},[n(_,null,{default:d((()=>[n(M)])),_:1})],8,K)])])])),default:d((()=>[n(_,null,{default:d((()=>[n(a)])),_:1})])),_:1},8,["file-list","accept","limit"]),o(s)?(u(),h(U,{key:0,"zoom-rate":1.2,"initial-index":o(r),"url-list":m.value,onClose:S},null,8,["initial-index","url-list"])):b("",!0)],64)}}}),$={class:"app-container"},B=e({__name:"upload",setup(e){const l=a("https://s2.loli.net/2023/05/24/yNsxFC8rLHMZQcK.jpg"),t=a(["https://s2.loli.net/2023/05/24/yNsxFC8rLHMZQcK.jpg"]),s=a([{name:"照片1.jpg",url:"https://s2.loli.net/2023/05/24/yNsxFC8rLHMZQcK.jpg"},{name:"照片2.jpg",url:"https://s2.loli.net/2023/05/24/RuHFMwW4rG5lIqs.jpg"}]);return(e,a)=>{const r=U,c=D,f=V,y=q,v=F;return u(),i("div",$,[n(r,{href:"https://gitee.com/youlaiorg/vue3-element-admin/blob/master/src/views/demo/upload.vue",type:"primary",target:"_blank",class:"mb-10"},{default:d((()=>a[3]||(a[3]=[m(" 示例源码 请点击>>>> ")]))),_:1,__:[3]}),n(v,null,{default:d((()=>[n(f,{label:"单图上传"},{default:d((()=>[n(c,{modelValue:o(l),"onUpdate:modelValue":a[0]||(a[0]=e=>p(l)?l.value=e:null)},null,8,["modelValue"])])),_:1}),n(f,{label:"多图上传"},{default:d((()=>[n(Z,{modelValue:o(t),"onUpdate:modelValue":a[1]||(a[1]=e=>p(t)?t.value=e:null),limit:2},null,8,["modelValue"])])),_:1}),n(f,{label:"文件上传"},{default:d((()=>[n(y,{modelValue:o(s),"onUpdate:modelValue":a[2]||(a[2]=e=>p(s)?s.value=e:null)},null,8,["modelValue"])])),_:1})])),_:1})])}}});export{B as default};
