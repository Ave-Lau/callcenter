import{d as e,r as l,S as a,o as t,g as o,f as r,m as s,w as i,i as d,C as n,Z as u,$ as p,V as m,e as c,h as f,F as _,b8 as g,as as b,P as v,Q as j,bw as h,aZ as y,aI as V}from"./index.BNf4mxQE.js";import{v as w}from"./el-loading.QL51ccJ4.js";import{E as x}from"./el-drawer.CACzoNLp.js";import"./el-overlay.BsvLSXXT.js";import{E as k}from"./el-switch.hfg1iVob.js";import{_ as U}from"./index.vue_vue_type_script_setup_true_lang.zFDq19y9.js";/* empty css               */import{E as C,a as I}from"./el-select.Csg3qY-Y.js";import"./el-scrollbar.BSUz6fvb.js";import"./el-popper.B-YX62Un.js";import"./el-tree.Dsvcf7n-.js";import"./el-checkbox.DP-pnqmO.js";import"./el-text.DAMXsLTi.js";import{E}from"./el-tree-select.BVqUfvgP.js";import{a as R,E as T}from"./el-col.BnxGfA2D.js";import{E as z}from"./el-card.dwNzOk9i.js";import{_ as q}from"./index.GIQbyZO1.js";import{a as B,E as D}from"./el-table-column.CL63ZTZD.js";import"./el-tooltip.l0sNRNKZ.js";import{_ as F}from"./DictLabel.vue_vue_type_script_setup_true_lang.BQDYVHTY.js";import{E as N,a as A}from"./el-form-item.DovvAFje.js";import{E as L}from"./el-button.EVl1EmMl.js";import{E as O}from"./el-date-picker.BkGx3XYh.js";import{E as P}from"./el-input.ClClGHKY.js";import{D as S}from"./dept.D96qZfWx.js";import{R as Y}from"./role.DZ6xiAiH.js";import{_ as Z}from"./DeptTree.vue_vue_type_script_setup_true_lang.DE1irAEf.js";import{_ as M}from"./UserImport.vue_vue_type_script_setup_true_lang.iYHcfwE7.js";import{E as $}from"./el-message-box.CDMpBOcN.js";import{E as K}from"./index.Cx4IHkS0.js";import"./index.l9G2LimK.js";import"./index.CwuJiZnh.js";import"./index.D88KRxG3.js";import"./error.Bg4g5axl.js";import"./scroll.CelKBJpM.js";import"./use-form-common-props.B1WHvisD.js";import"./el-radio.mAwmtY4K.js";import"./token.DWNpOE8r.js";import"./strings.DaRxdfmw.js";import"./castArray.N4XM5oBs.js";import"./isEqual.C4vU9DCW.js";import"./_Uint8Array.Cx-nGP6U.js";import"./index.DzApxU-c.js";import"./debounce.ZykLP5uq.js";import"./_baseIteratee.CGENy10K.js";import"./index.B4Ld_3Y0.js";import"./el-pagination.C7pXcUz-.js";import"./_plugin-vue_export-helper.BCo6x5W8.js";import"./index.BWdYtkKV.js";import"./index.MIo-y8SA.js";import"./el-alert.K2EhEJn3.js";import"./el-dialog.CSd8OVeO.js";import"./refs.Cxh2Q1oA.js";import"./el-progress.C3ve27VY.js";import"./el-link.C-7CLgmT.js";const Q={class:"app-container"},G={class:"search-bar"},H={class:"flex-x-between mb-10px"},J={class:"dialog-footer"},W=e({name:"User",inheritAttrs:!1,__name:"index",setup(e){const W=l(),X=l(),ee=a({pageNum:1,pageSize:10}),le=l(),ae=l(0),te=l(!1),oe=a({visible:!1,title:"新增用户"}),re=a({status:1}),se=a({username:[{required:!0,message:"用户名不能为空",trigger:"blur"}],nickname:[{required:!0,message:"用户昵称不能为空",trigger:"blur"}],deptId:[{required:!0,message:"所属部门不能为空",trigger:"blur"}],roleIds:[{required:!0,message:"用户角色不能为空",trigger:"blur"}],email:[{pattern:/\w[-\w.+]*@([A-Za-z0-9][-A-Za-z0-9]+\.)+[A-Za-z]{2,14}/,message:"请输入正确的邮箱地址",trigger:"blur"}],mobile:[{pattern:/^1[3|4|5|6|7|8|9][0-9]\d{8}$/,message:"请输入正确的手机号码",trigger:"blur"}]}),ie=l([]),de=l(),ne=l(),ue=l(!1);function pe(){te.value=!0,y.getPage(ee).then((e=>{le.value=e.list,ae.value=e.total})).finally((()=>{te.value=!1}))}function me(){W.value.resetFields(),ee.pageNum=1,ee.deptId=void 0,ee.createTime=void 0,pe()}function ce(e){ie.value=e.map((e=>e.id))}async function fe(e){oe.visible=!0,ne.value=await Y.getOptions(),de.value=await S.getOptions(),e?(oe.title="修改用户",y.getFormData(e).then((e=>{Object.assign(re,{...e})}))):oe.title="新增用户"}function _e(){oe.visible=!1,X.value.resetFields(),X.value.clearValidate(),re.id=void 0,re.status=1}const ge=h((()=>{X.value.validate((e=>{if(e){const e=re.id;te.value=!0,e?y.update(e,re).then((()=>{V.success("修改用户成功"),_e(),me()})).finally((()=>te.value=!1)):y.add(re).then((()=>{V.success("新增用户成功"),_e(),me()})).finally((()=>te.value=!1))}}))}),1e3);function be(e){const l=[e||ie.value].join(",");l?$.confirm("确认删除用户?","警告",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){te.value=!0,y.deleteByIds(l).then((()=>{V.success("删除成功"),me()})).finally((()=>te.value=!1))}),(function(){V.info("已取消删除")})):V.warning("请勾选删除项")}function ve(){ue.value=!0}function je(){y.export(ee).then((e=>{const l=e.data,a=decodeURI(e.headers["content-disposition"].split(";")[1].split("=")[1]),t=new Blob([l],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet;charset=utf-8"}),o=window.URL.createObjectURL(t),r=document.createElement("a");r.href=o,r.download=a,document.body.appendChild(r),r.click(),document.body.removeChild(r),window.URL.revokeObjectURL(o)}))}return t((()=>{pe()})),(e,l)=>{const a=R,t=P,h=A,S=I,Y=C,he=O,ye=L,Ve=N,we=B,xe=F,ke=K,Ue=D,Ce=q,Ie=z,Ee=T,Re=E,Te=U,ze=k,qe=x,Be=g("hasPerm"),De=w;return r(),o("div",Q,[s(Ee,{gutter:20},{default:i((()=>[s(a,{lg:4,xs:24,class:"mb-[12px]"},{default:i((()=>[s(Z,{modelValue:d(ee).deptId,"onUpdate:modelValue":l[0]||(l[0]=e=>d(ee).deptId=e),onNodeClick:pe},null,8,["modelValue"])])),_:1}),s(a,{lg:20,xs:24},{default:i((()=>[n("div",G,[s(Ve,{ref_key:"queryFormRef",ref:W,model:d(ee),inline:!0},{default:i((()=>[s(h,{label:"关键字",prop:"keywords"},{default:i((()=>[s(t,{modelValue:d(ee).keywords,"onUpdate:modelValue":l[1]||(l[1]=e=>d(ee).keywords=e),placeholder:"用户名/昵称/手机号",clearable:"",style:{width:"200px"},onKeyup:u(pe,["enter"])},null,8,["modelValue"])])),_:1}),s(h,{label:"状态",prop:"status"},{default:i((()=>[s(Y,{modelValue:d(ee).status,"onUpdate:modelValue":l[2]||(l[2]=e=>d(ee).status=e),placeholder:"全部",clearable:"",class:"!w-[100px]"},{default:i((()=>[s(S,{label:"正常",value:1}),s(S,{label:"禁用",value:0})])),_:1},8,["modelValue"])])),_:1}),s(h,{label:"创建时间"},{default:i((()=>[s(he,{modelValue:d(ee).createTime,"onUpdate:modelValue":l[3]||(l[3]=e=>d(ee).createTime=e),editable:!1,class:"!w-[240px]",type:"daterange","range-separator":"~","start-placeholder":"开始时间","end-placeholder":"截止时间","value-format":"YYYY-MM-DD"},null,8,["modelValue"])])),_:1}),s(h,null,{default:i((()=>[s(ye,{type:"primary",icon:"search",onClick:pe},{default:i((()=>l[20]||(l[20]=[p("搜索")]))),_:1,__:[20]}),s(ye,{icon:"refresh",onClick:me},{default:i((()=>l[21]||(l[21]=[p("重置")]))),_:1,__:[21]})])),_:1})])),_:1},8,["model"])]),s(Ie,{shadow:"never"},{default:i((()=>[n("div",H,[n("div",null,[m((r(),c(ye,{type:"success",icon:"plus",onClick:l[4]||(l[4]=e=>fe())},{default:i((()=>l[22]||(l[22]=[p(" 新增 ")]))),_:1,__:[22]})),[[Be,["sys:user:add"]]]),m((r(),c(ye,{type:"danger",icon:"delete",disabled:0===d(ie).length,onClick:l[5]||(l[5]=e=>be())},{default:i((()=>l[23]||(l[23]=[p(" 删除 ")]))),_:1,__:[23]},8,["disabled"])),[[Be,"sys:user:delete"]])]),n("div",null,[m((r(),c(ye,{icon:"upload",onClick:ve},{default:i((()=>l[24]||(l[24]=[p(" 导入 ")]))),_:1,__:[24]})),[[Be,"sys:user:import"]]),m((r(),c(ye,{icon:"download",onClick:je},{default:i((()=>l[25]||(l[25]=[p(" 导出 ")]))),_:1,__:[25]})),[[Be,"sys:user:export"]])])]),m((r(),c(Ue,{data:d(le),onSelectionChange:ce},{default:i((()=>[s(we,{type:"selection",width:"50",align:"center"}),s(we,{label:"用户名",prop:"username"}),s(we,{label:"昵称",width:"150",align:"center",prop:"nickname"}),s(we,{label:"性别",width:"100",align:"center"},{default:i((e=>[s(xe,{modelValue:e.row.gender,"onUpdate:modelValue":l=>e.row.gender=l,code:"gender"},null,8,["modelValue","onUpdate:modelValue"])])),_:1}),s(we,{label:"部门",width:"120",align:"center",prop:"deptName"}),s(we,{label:"手机号码",align:"center",prop:"mobile",width:"120"}),s(we,{label:"邮箱",align:"center",prop:"email",width:"160"}),s(we,{label:"状态",align:"center",prop:"status",width:"80"},{default:i((e=>[s(ke,{type:1==e.row.status?"success":"info"},{default:i((()=>[p(_(1==e.row.status?"正常":"禁用"),1)])),_:2},1032,["type"])])),_:1}),s(we,{label:"创建时间",align:"center",prop:"createTime",width:"150"}),s(we,{label:"操作",fixed:"right",width:"220"},{default:i((e=>[m((r(),c(ye,{type:"primary",icon:"RefreshLeft",size:"small",link:"",onClick:l=>{return a=e.row,void $.prompt("请输入用户【"+a.username+"】的新密码","重置密码",{confirmButtonText:"确定",cancelButtonText:"取消"}).then((({value:e})=>{if(!e||e.length<6)return V.warning("密码至少需要6位字符，请重新输入"),!1;y.resetPassword(a.id,e).then((()=>{V.success("密码重置成功，新密码是："+e)}))}),(()=>{V.info("已取消重置密码")}));var a}},{default:i((()=>l[26]||(l[26]=[p(" 重置密码 ")]))),_:2,__:[26]},1032,["onClick"])),[[Be,"sys:user:password:reset"]]),m((r(),c(ye,{type:"primary",icon:"edit",link:"",size:"small",onClick:l=>fe(e.row.id)},{default:i((()=>l[27]||(l[27]=[p(" 编辑 ")]))),_:2,__:[27]},1032,["onClick"])),[[Be,"sys:user:edit"]]),m((r(),c(ye,{type:"danger",icon:"delete",link:"",size:"small",onClick:l=>be(e.row.id)},{default:i((()=>l[28]||(l[28]=[p(" 删除 ")]))),_:2,__:[28]},1032,["onClick"])),[[Be,"sys:user:delete"]])])),_:1})])),_:1},8,["data"])),[[De,d(te)]]),d(ae)>0?(r(),c(Ce,{key:0,total:d(ae),"onUpdate:total":l[6]||(l[6]=e=>b(ae)?ae.value=e:null),page:d(ee).pageNum,"onUpdate:page":l[7]||(l[7]=e=>d(ee).pageNum=e),limit:d(ee).pageSize,"onUpdate:limit":l[8]||(l[8]=e=>d(ee).pageSize=e),onPagination:pe},null,8,["total","page","limit"])):f("",!0)])),_:1})])),_:1})])),_:1}),s(qe,{modelValue:d(oe).visible,"onUpdate:modelValue":l[17]||(l[17]=e=>d(oe).visible=e),title:d(oe).title,"append-to-body":"",onClose:_e},{footer:i((()=>[n("div",J,[s(ye,{type:"primary",onClick:d(ge)},{default:i((()=>l[29]||(l[29]=[p("确 定")]))),_:1,__:[29]},8,["onClick"]),s(ye,{onClick:_e},{default:i((()=>l[30]||(l[30]=[p("取 消")]))),_:1,__:[30]})])])),default:i((()=>[s(Ve,{ref_key:"userFormRef",ref:X,model:d(re),rules:d(se),"label-width":"80px"},{default:i((()=>[s(h,{label:"用户名",prop:"username"},{default:i((()=>[s(t,{modelValue:d(re).username,"onUpdate:modelValue":l[9]||(l[9]=e=>d(re).username=e),readonly:!!d(re).id,placeholder:"请输入用户名"},null,8,["modelValue","readonly"])])),_:1}),s(h,{label:"用户昵称",prop:"nickname"},{default:i((()=>[s(t,{modelValue:d(re).nickname,"onUpdate:modelValue":l[10]||(l[10]=e=>d(re).nickname=e),placeholder:"请输入用户昵称"},null,8,["modelValue"])])),_:1}),s(h,{label:"所属部门",prop:"deptId"},{default:i((()=>[s(Re,{modelValue:d(re).deptId,"onUpdate:modelValue":l[11]||(l[11]=e=>d(re).deptId=e),placeholder:"请选择所属部门",data:d(de),filterable:"","check-strictly":"","render-after-expand":!1},null,8,["modelValue","data"])])),_:1}),s(h,{label:"性别",prop:"gender"},{default:i((()=>[s(Te,{modelValue:d(re).gender,"onUpdate:modelValue":l[12]||(l[12]=e=>d(re).gender=e),code:"gender"},null,8,["modelValue"])])),_:1}),s(h,{label:"角色",prop:"roleIds"},{default:i((()=>[s(Y,{modelValue:d(re).roleIds,"onUpdate:modelValue":l[13]||(l[13]=e=>d(re).roleIds=e),multiple:"",placeholder:"请选择"},{default:i((()=>[(r(!0),o(v,null,j(d(ne),(e=>(r(),c(S,{key:e.value,label:e.label,value:e.value},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),s(h,{label:"手机号码",prop:"mobile"},{default:i((()=>[s(t,{modelValue:d(re).mobile,"onUpdate:modelValue":l[14]||(l[14]=e=>d(re).mobile=e),placeholder:"请输入手机号码",maxlength:"11"},null,8,["modelValue"])])),_:1}),s(h,{label:"邮箱",prop:"email"},{default:i((()=>[s(t,{modelValue:d(re).email,"onUpdate:modelValue":l[15]||(l[15]=e=>d(re).email=e),placeholder:"请输入邮箱",maxlength:"50"},null,8,["modelValue"])])),_:1}),s(h,{label:"状态",prop:"status"},{default:i((()=>[s(ze,{modelValue:d(re).status,"onUpdate:modelValue":l[16]||(l[16]=e=>d(re).status=e),"inline-prompt":"","active-text":"正常","inactive-text":"禁用","active-value":1,"inactive-value":0},null,8,["modelValue"])])),_:1})])),_:1},8,["model","rules"])])),_:1},8,["modelValue","title"]),s(M,{modelValue:d(ue),"onUpdate:modelValue":l[18]||(l[18]=e=>b(ue)?ue.value=e:null),onImportSuccess:l[19]||(l[19]=e=>pe())},null,8,["modelValue"])])}}});export{W as default};
