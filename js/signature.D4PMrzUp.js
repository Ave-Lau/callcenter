import{d as e,r as t,o,g as n,f as a,C as s,h as r,m as l,w as c,$ as i,j as u,i as d,aC as h}from"./index.v8tsX86a.js";import{E as p}from"./el-button.BLOYf6uz.js";import{F as f}from"./index.B4zDGQpZ.js";import{_ as m}from"./_plugin-vue_export-helper.BCo6x5W8.js";import"./index.DkfcTd2R.js";import"./use-form-common-props.BesHhqMc.js";const v={class:"canvas-dom"},g=["src"],_=m(e({__name:"signature",setup(e){const m=t(""),_=t();let w,y=!1;const k=e=>{let t;if(e.offsetX){const{offsetX:o,offsetY:n}=e;t=[o,n]}else{const{top:o,left:n}=_.value.getBoundingClientRect();t=[e.touches[0].clientX-n,e.touches[0].clientY-o]}return t};let C=0,j=0;const x=e=>{[C,j]=k(e),y=!0},R=e=>{if(y){const[t,o]=k(e);!function(e,t,o,n,a){a.beginPath(),a.globalAlpha=1,a.lineWidth=2,a.strokeStyle="#000",a.moveTo(e,t),a.lineTo(o,n),a.closePath(),a.stroke()}(C,j,t,o,w),C=t,j=o}},b=()=>{y&&(y=!1)};o((()=>{w=_.value.getContext("2d")}));const E=async()=>{if(U(_.value))return void h({type:"warning",message:"当前签名文件为空"});const e=L(_.value.toDataURL(),"签名.png");if(!e)return;const t=await f.uploadFile(e);T(),m.value=t.url},T=()=>{w.clearRect(0,0,_.value.width,_.value.height)},U=e=>{const t=document.createElement("canvas");return t.width=e.width,t.height=e.height,e.toDataURL()==t.toDataURL()},D=()=>{if(U(_.value))return void h({type:"warning",message:"当前签名文件为空"});const e=document.createElement("a");e.href=_.value.toDataURL(),e.download="签名";const t=new MouseEvent("click");e.dispatchEvent(t)},L=(e,t)=>{const o=e.split(",");if(!o.length)return;const n=o[0].match(/:(.*?);/);if(n){const e=atob(o[1]);let a=e.length;const s=new Uint8Array(a);for(;a--;)s[a]=e.charCodeAt(a);return new File([s],t,{type:n[1]})}};return(e,t)=>{const o=p;return a(),n("div",v,[t[3]||(t[3]=s("h3",null,"基于canvas实现的签名组件",-1)),s("header",null,[l(o,{type:"primary",onClick:D},{default:c((()=>t[0]||(t[0]=[i("保存为图片")]))),_:1,__:[0]}),l(o,{onClick:E},{default:c((()=>t[1]||(t[1]=[i("保存到后端")]))),_:1,__:[1]}),l(o,{onClick:T},{default:c((()=>t[2]||(t[2]=[i("清空签名")]))),_:1,__:[2]})]),s("canvas",{ref_key:"canvas",ref:_,height:"200",width:"500",onMousedown:x,onMousemove:u(R,["stop","prevent"]),onMouseup:b,onTouchstart:x,onTouchmove:u(R,["stop","prevent"]),onTouchend:b},null,544),d(m)?(a(),n("img",{key:0,src:d(m),alt:"签名"},null,8,g)):r("",!0)])}}}),[["__scopeId","data-v-1cba7987"]]);export{_ as default};
